
# Windsurf Database Setup

This folder contains everything needed to set up your MySQL database independently of Supabase, including all your existing data.

## Quick Start

1. **Install Dependencies**
   ```bash
   cd windsurf-database
   npm install
   ```

2. **Export Your Data from Supabase**
   ```bash
   npm run export
   ```

3. **Set Up MySQL Database**
   ```bash
   # Create database
   mysql -u root -p
   CREATE DATABASE grievance_portal;
   exit
   
   # Import schema
   mysql -u root -p grievance_portal < 01_schema.sql
   
   # Import your actual data
   mysql -u root -p grievance_portal < 02_actual_data.sql
   ```

4. **Start MySQL with Docker (Optional)**
   ```bash
   docker-compose up -d
   ```

## Files Overview

- **`01_schema.sql`** - Complete database schema with all tables, indexes, and constraints
- **`02_actual_data.sql`** - Your exported data from Supabase (generated by export utility)
- **`data-export-utility.js`** - Node.js script to export data from Supabase
- **`docker-compose.yml`** - MySQL and phpMyAdmin setup
- **`export-instructions.md`** - Detailed export instructions

## Database Structure

### Core Tables
- `employees` - Employee master data
- `dashboard_users` - Admin/dashboard users
- `issues` - All grievance tickets
- `issue_comments` - Public comments on issues
- `issue_internal_comments` - Internal admin comments

### Master Data
- `master_cities` - City master data
- `master_clusters` - Cluster/region data
- `master_roles` - Role definitions

### RBAC System
- `rbac_roles` - Role-based access control roles
- `rbac_permissions` - System permissions
- `rbac_role_permissions` - Role-permission mappings
- `rbac_user_roles` - User-role assignments

### Audit & Feedback
- `ticket_feedback` - User feedback on resolved tickets
- `issue_audit_trail` - Complete audit trail for all issue changes
- `dashboard_user_audit_logs` - Admin user activity logs
- `master_audit_logs` - Master data change logs

## Default Credentials

After importing the data, you can use these credentials to access the system:

### Admin Dashboard
- **Email**: admin@yulu.com
- **Password**: password

### Employee Login
- **Employee ID**: EMP001
- **Password**: EMP001

## Configuration

Update your backend `.env` file to use MySQL:

```env
# Database Configuration
DB_HOST=localhost
DB_PORT=3306
DB_NAME=grievance_portal
DB_USER=grievance_user
DB_PASSWORD=grievance_password

# For root access (development only)
# DB_USER=root
# DB_PASSWORD=your_root_password
```

## Docker Setup (Optional)

The included `docker-compose.yml` provides:
- MySQL 8.0 server
- phpMyAdmin for database management
- Automatic database initialization

```bash
# Start services
docker-compose up -d

# Access phpMyAdmin
http://localhost:8080
```

## Data Migration Features

- âœ… **Complete Data Export** - All tables and relationships preserved
- âœ… **UUID Compatibility** - Maintains all existing UUIDs
- âœ… **Data Type Conversion** - Handles PostgreSQL to MySQL differences
- âœ… **Foreign Key Preservation** - All relationships maintained
- âœ… **JSON Data Support** - Complex JSON fields preserved
- âœ… **Audit Trail Continuity** - Complete history maintained

## Verification

After importing, verify your data:

```sql
-- Check record counts
SELECT 'employees' as table_name, COUNT(*) as count FROM employees
UNION ALL
SELECT 'issues', COUNT(*) FROM issues
UNION ALL
SELECT 'issue_comments', COUNT(*) FROM issue_comments;

-- Check data integrity
SELECT COUNT(*) as orphaned_comments 
FROM issue_comments ic 
LEFT JOIN issues i ON ic.issue_id = i.id 
WHERE i.id IS NULL;
```

## Next Steps

1. Import your data using the export utility
2. Update backend configuration to use MySQL
3. Test all application functionality
4. Set up regular database backups
5. Configure monitoring and alerting

Your application will now run completely independently of Supabase! ðŸŽ‰
